#!/usr/bin/env sh

# Run lint-staged (eslint on staged .ts/.tsx, stylelint on staged .css)
echo "Running lint-staged..."
npx lint-staged

# Run TypeScript type checking
echo "Running TypeScript type check..."
npx tsc --noEmit

# Run tests related to staged files
echo "Running tests for staged files..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(ts|tsx)$' | grep -v '\.test\.' | tr '\n' ' ')
if [ -n "$STAGED_FILES" ]; then
  npx jest --passWithNoTests --findRelatedTests $STAGED_FILES
else
  echo "No staged source files to test."
fi
